import{d as B,o as p,e as I,g as P,E as j,G as F,c as L,r as i,w as G,j as U,I as J,s as q,x as o,u as s,J as _,A as Q,K as W,z as D,f as v,v as l,p as y,q as z,S as Y,L as E,l as V,Q as X,be as Z,C as ee,N as ae}from"./index-4ea25042.js";import{a as te,e as se,b as oe,N as le}from"./Spin-3927a8e6.js";import{N as ne,a as re}from"./BreadcrumbItem-dd2d84da.js";import{a as ie,N as de}from"./FormItem-8706d53a.js";import{N as ue}from"./InputGroup-5fd6189d.js";import{N as ce}from"./Space-78fc94fc.js";import"./Checkbox-e08e1118.js";const _e={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},pe=P('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 3v4a1 1 0 0 0 1 1h4"></path><path d="M17 21H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7l5 5v11a2 2 0 0 1-2 2z"></path><path d="M9 17v-5"></path><path d="M12 17v-1"></path><path d="M15 17v-3"></path></g>',1),ve=[pe],he=B({name:"FileAnalytics",render:function(n,S){return p(),I("svg",_e,ve)}}),me={class:"share-info-page"},fe={key:0,class:"header"},ke={class:"title n-ellipsis"},ge={class:"action"},we={key:1,class:"share-password"},ye=v("a",{href:"https://mypikpak.com/",target:"_blank",class:"logo-box"},[v("img",{src:"https://www.mypikpak.com/logo.png",class:"logo-box__icon",alt:""}),v("div",{class:"logo-box__text"},"PikPak")],-1),Ne={key:2,class:"share-file-box",style:{height:"100vh"}},Me=B({__name:"shareInfo",setup(T){const n=j(),S=F(),M=L(()=>n.params.id),a=i(),h=i(!0),d=i(""),u=i([]),N=i([]),C=i(""),H=i([{type:"selection"},{title:"名称",key:"name",sorter:"default",render:e=>_("div",{class:"file-info",onClick:()=>{e.kind==="drive#folder"&&(n.query.id||(C.value=e.id),S.push({name:"shareInfo",params:n.params,query:{id:e.id}}))}},[_("img",{src:e.thumbnail_link||e.icon_link}),_(te,{class:"title"},{default:()=>String(e.name)}),_("span",{class:"action"},"1")])},{title:"大小",key:"size",sorter:(e,t)=>e.size-t.size,align:"right",render:e=>Number(e.size)>0?Q(Number(e.size)):"",className:"size",width:100},{title:"修改时间",key:"modified_time",sorter:"default",align:"right",render:e=>_(W,{time:new Date(String(e.modified_time)||""),format:"MM-dd HH:MM"}),className:"modified_time",width:160},{title:"",key:"action",width:60,align:"right",render:e=>_(ce,{justify:"end"},{default:()=>[]})}]),m=()=>{var e,t,f,k,g;if(((e=a.value)==null?void 0:e.share_status)!=="OK"&&n.query.id)return S.push({name:"shareInfo",params:n.params,query:{id:""}});h.value=!0,D.get("https://api-drive.mypikpak.com/drive/v1/share"+(n.query.id&&((t=a.value)!=null&&t.pass_code_token)?"/detail":""),{params:{share_id:M.value,parent_id:n.query.id,pass_code_token:((f=a.value)==null?void 0:f.pass_code_token)||void 0,pass_code:(k=a.value)!=null&&k.pass_code_token?void 0:d.value,limit:"30",page_token:(g=a.value)==null?void 0:g.next_page_token}}).then(c=>{var w;const{files:x,...b}=c.data,r=(w=a.value)==null?void 0:w.next_page_token;a.value=Object.assign(a.value||{},b),c.data.share_status==="OK"?(r||(N.value=[]),N.value=N.value.concat(x)):window.$message.error(c.data.share_status)}).finally(()=>{h.value=!1})},R=e=>{var t;e.target.offsetHeight+e.target.scrollTop>=e.target.scrollHeight-30&&(t=a.value)!=null&&t.next_page_token&&!h.value&&m()},$=()=>{var t;const e=[];n.query.id&&e.push(C.value),D.post("https://api-drive.mypikpak.com/drive/v1/share/restore",{share_id:M.value,pass_code_token:(t=a.value)==null?void 0:t.pass_code_token,ancestor_ids:e,file_ids:u.value||void 0,folder_type:"DOWNLOAD"}).then(f=>{window.$message.success("转存成功，可能需要等待一段时间"),u.value=[]})};G(n,(e,t)=>{d.value=String(n.params.password)||"",u.value=[],a.value&&(a.value.next_page_token="",a.value.files=[]),m()});const A=()=>{window.location.href="./"};return U(()=>{d.value=String(n.params.password)||"",C.value="",m(),window.onbeforeunload=function(e){return!window.$downId||window.$downId.length===0?null:(e=e||window.event,e&&(e.returnValue="还有待下载文件"),"还有待下载文件?")}}),(e,t)=>{const f=J("router-link");return p(),q(s(le),{show:h.value,description:"获取中"},{default:o(()=>{var k,g,c,x,b;return[v("div",me,[((k=a.value)==null?void 0:k.share_status)==="OK"?(p(),I("div",fe,[v("div",ke,[l(s(re),{separator:">"},{default:o(()=>[l(s(ne),null,{default:o(()=>[l(f,{to:{query:{id:""}}},{default:o(()=>[y("全部文件")]),_:1})]),_:1})]),_:1}),l(s(Y),{depth:"3",style:{"font-size":"12px"}},{default:o(()=>{var r,w,K,O;return[y(" 失效时间： "+z(((r=a.value)==null?void 0:r.expiration_left)==="-1"?"永久有效":((w=a.value)==null?void 0:w.expiration_left)+"天")+" 失效次数："+z(((K=a.value)==null?void 0:K.restore_count_left)==="-1"?"无限次":((O=a.value)==null?void 0:O.restore_count_left)+"次"),1)]}),_:1})]),v("div",ge,[l(s(E),{type:"primary",onClick:$},{default:o(()=>[y(z(u.value.length?"转存已选":"转存全部"),1)]),_:1})])])):V("",!0),((g=a.value)==null?void 0:g.share_status)==="PASS_CODE_EMPTY"||((c=a.value)==null?void 0:c.share_status)==="PASS_CODE_ERROR"?(p(),I("div",we,[ye,l(s(de),{class:"password-form"},{default:o(()=>[l(s(ie),{label:"请输入提取码"},{default:o(()=>[l(s(ue),null,{default:o(()=>[l(s(X),{value:d.value,"onUpdate:value":t[0]||(t[0]=r=>d.value=r),type:"password","show-password-on":"mousedown",placeholder:"请输入提取码",onKeyup:Z(m,["enter"])},null,8,["value","onKeyup"]),l(s(E),{type:"primary",loading:h.value&&!!d.value,onClick:m},{default:o(()=>[y("提取文件")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})])):((x=a.value)==null?void 0:x.share_status)==="DELETED"?(p(),I("div",Ne,[l(s(se),{description:"抱歉，该分享已被作者删除"},{icon:o(()=>[l(s(ee),null,{default:o(()=>[l(s(he))]),_:1})]),extra:o(()=>[l(s(E),{size:"small",onClick:A},{default:o(()=>[y("去首页")]),_:1})]),_:1})])):((b=a.value)==null?void 0:b.share_status)==="OK"?(p(),q(s(ae),{key:3,style:{"max-height":"calc(100vh - 110px)"},onScroll:R},{default:o(()=>[l(s(oe),{"checked-row-keys":u.value,"onUpdate:checkedRowKeys":t[1]||(t[1]=r=>u.value=r),"row-key":r=>r.id,data:N.value,size:"small",columns:H.value,bordered:!1},null,8,["checked-row-keys","row-key","data","columns"])]),_:1})):V("",!0)])]}),_:1},8,["show"])}}});export{Me as default};
